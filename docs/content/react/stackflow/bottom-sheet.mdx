---
title: Bottom Sheet
description: Bottom Sheet를 Stackflow와 함께 사용하는 방법을 안내합니다.
---

<Card title="Bottom Sheet" href="/react/components/bottom-sheet">

Bottom Sheet 컴포넌트에 대해 자세히 알아봅니다.

</Card>

## Making a Bottom Sheet Activity

**일반적인 경우 Bottom Sheet를 [Activity](https://stackflow.so/docs/get-started/activity)로 만들어 사용하는 것을 권장합니다.**

- Activity로 관리되므로, 하위 Activity보다 높고 상위 Activity보다는 낮은 z-index를 갖도록 관리하기 쉽습니다.
- 딥링킹이 가능합니다. (URL 접속으로 Bottom Sheet를 열 수 있습니다.)
- [@stackflow/plugin-basic-ui](https://www.npmjs.com/package/@stackflow/plugin-basic-ui) `BottomSheet`에서의 마이그레이션이 쉽습니다.

<StackflowExample path="/bottom-sheet-activity">
  ```json doc-gen:file
  {
    "file": "../examples/stackflow-spa/src/activities/ActivityBottomSheetActivity.tsx",
    "codeblock": {
      "meta": "title='ActivityBottomSheetActivity.tsx'"
    }
  }
  ```
  ```json doc-gen:file
  {
    "file": "../examples/stackflow-spa/src/activities/ActivityBottomSheet.tsx",
    "codeblock": {
      "meta": "title='ActivityBottomSheet.tsx'"
    }
  }
  ```
</StackflowExample>

### Usage

```tsx
import { useActivityZIndexBase } from "@grape_design_react/stackflow";
import { useActivity, useFlow, type ActivityComponentType } from "@stackflow/react/future";
// ... more imports

const ActivityBottomSheetSimple: ActivityComponentType<"ActivityBottomSheetSimple"> = () => {
  const { pop } = useFlow();

  return (
    {/* [!code highlight] */}
    <BottomSheetRoot open={useActivity().isActive} onOpenChange={(open) => !open && pop()}>
      <BottomSheetContent
        title="Activity로 만들어진 BottomSheet"
        // [!code highlight]
        layerIndex={useActivityZIndexBase()}
      >
        <BottomSheetFooter>
          <ActionButton onClick={pop}>
            확인
          </ActionButton>
        </BottomSheetFooter>
      </BottomSheetContent>
    </BottomSheetRoot>
  );
};
```

1. `open` prop에 `useActivity().isActive`를 전달하여 Activity가 활성화될 때 Bottom Sheet가 열리도록 합니다.
1. `onOpenChange`를 통해 Bottom Sheet가 닫힐 때 `pop()`을 실행하여 Activity를 종료합니다.
1. `layerIndex={useActivityZIndexBase()}`로 Bottom Sheet Activity의 z-index 기준점을 전달합니다.

- [`useActivityZIndexBase`에 대해 자세히 알아보기](#about-useactivityzindexbase)

#### Keeping Bottom Sheet Mounted

Bottom Sheet Activity 위에 다른 Activity를 push할 때 Bottom Sheet가 unmount되는 것을 방지하려면,

- `open` 상태를 `isActive` 대신 `transitionState`로 관리하고
- `onOpenChange` 핸들러에서 `!isOpen && isActive`인 경우 `pop()`을 실행하도록 합니다.

이 패턴은 다음 상황에서 유용합니다.

- Bottom Sheet 액티비티 위에 다른 오버레이 컴포넌트 액티비티를 중첩하여 표시하고 싶은 경우
- 하위 Bottom Sheet 액티비티 내부에 존재하는 Uncontrolled 폼 요소의 상태를 유지하고 싶은 경우

```tsx
const { isActive, transitionState } = useActivity();

return (
  <BottomSheetRoot
    open={
      // [!code highlight]
      transitionState === "enter-active" || transitionState === "enter-done"
    }
    // [!code highlight]
    onOpenChange={(open) => !open && isActive && pop()}
  >
    {/* ... */}
  </BottomSheetRoot>
);
```

## Syncing BottomSheet State with a Step

Bottom Sheet를 Activity로 만들 수 없는 경우, Bottom Sheet가 표시된 상태를 [Step](https://stackflow.so/docs/get-started/navigating-step)으로 만들 수 있습니다.

- 현재 Activity를 유지하면서도, 뒤로 가기 버튼 등으로 Bottom Sheet를 닫을 수 있습니다.
- `BottomSheetTrigger`를 사용하여 Bottom Sheet를 열고 닫을 수 있습니다.

<Callout type="warn" title="제약 사항">

**Activity로 만들지 않은 Bottom Sheet에서 다른 Activity를 push하기 전, z-index 문제를 방지하기 위해 Bottom Sheet를 닫으세요.**

Bottom Sheet를 닫을 수 없거나, Bottom Sheet를 연 Activity로 돌아왔을 때 Bottom Sheet가 열린 상태를 유지해야 하는 경우 [Bottom Sheet를 Activity로](#making-a-bottom-sheet-activity) 만들어 사용하는 것을 권장합니다.

Activity 간 유려한 트랜지션을 제공하기 위해 하위 AppScreen 요소 중 일부가 상위 AppScreen 요소보다 위에 위치합니다. 이 제약으로 인해, 열린 상태의 Bottom Sheet는 독립적인 Activity로 만들지 않는 경우 하위 Activity와 상위 Activity 사이에 위치시키는 것이 불가능합니다.

</Callout>

<StackflowExample path="/bottom-sheet-step">
  ```json doc-gen:file
  {
    "file": "../examples/stackflow-spa/src/activities/ActivityBottomSheetStep.tsx",
    "codeblock": {
      "meta": "title='ActivityBottomSheetStep.tsx'"
    }
  }
  ```
</StackflowExample>

### Usage

```tsx
import { useActivityZIndexBase } from "@grape_design_react/stackflow";
import { Portal } from "@grape_design_react/react";
import {
  useActivity,
  useActivityParams,
  useFlow,
  useStepFlow,
  type ActivityComponentType,
} from "@stackflow/react/future";
import { useEffect, useState } from "react";
// ... more imports

declare module "@stackflow/config" {
  interface Register {
    ActivityHome: {
      "bottom-sheet"?: "open";
    };
  }
}

const ActivityHome: ActivityComponentType<"ActivityHome"> = () => {
  const [open, setOpen] = useState(false);

  const { push } = useFlow();
  const { pushStep, popStep } = useStepFlow("ActivityHome");
  const params = useActivityParams<"ActivityHome">();
  // [!code highlight]
  const isOverlayOpen = params["bottom-sheet"] === "open";

  // [!code highlight]
  useEffect(() => {
    if (!isOverlayOpen) {
      setOpen(false);
    }
  }, [isOverlayOpen]);

  // [!code highlight]
  const onOpenChange = (newOpen: boolean) => {
    setOpen(newOpen);

    if (newOpen && !isOverlayOpen) {
      pushStep((params) => ({ ...params, "bottom-sheet": "open" }));

      return;
    }

    if (!newOpen && isOverlayOpen) {
      popStep();

      return;
    }
  };

  return (
    <AppScreen>
      <BottomSheetRoot open={open} onOpenChange={onOpenChange}>
        <BottomSheetTrigger asChild>
          <ActionButton>Open</ActionButton>
        </BottomSheetTrigger>
        {/* [!code highlight] */}
        <Portal>
          <BottomSheetContent
            title="Step으로 관리되는 Bottom Sheet"
            // [!code highlight]
            layerIndex={useActivityZIndexBase({ activityOffset: 1 })}
          >
            <BottomSheetFooter>
              <HStack gap="x2">
                <ActionButton onClick={() => setOpen(false)}>취소</ActionButton>
                <ActionButton
                  onClick={() => {
                    // [!code highlight]
                    setOpen(false); // 다른 Activity로 이동하기 전에는 Bottom Sheet를 닫으세요.
                    push("ActivityNext");
                  }}
                >
                  다음
                </ActionButton>
              </HStack>
            </BottomSheetFooter>
          </BottomSheetContent>
          {/* [!code highlight] */}
        </Portal>
      </BottomSheetRoot>
    </AppScreen>
  );
};
```

1. `Portal`을 사용하여 Bottom Sheet가 DOM 상 현재 Activity 밖에 렌더링되도록 합니다.
1. `open` prop를 관리하고, `onOpenChange` 핸들러를 통해 Step 상태와 동기화합니다.
1. 뒤로 가기 버튼 등을 통해 Activity 파라미터가 변경될 때 Bottom Sheet의 `open` 상태를 동기화합니다.
1. `layerIndex={useActivityZIndexBase({ activityOffset: 1 })}`로 현재 Activity보다 한 단계 높은 z-index 기준점을 전달합니다.
   - [`useActivityZIndexBase`에 대해 자세히 알아보기](#about-useactivityzindexbase)

### `useStepOverlay`

#2와 #3을 일반화하여 `useStepOverlay`를 사용하면 편리합니다. `useStepOverlay` 구현 예시는 [코드](https://github.com/daangn/grape_design_react/blob/dev/examples/stackflow-spa/src/grape_design_react/stackflow/use-step-overlay.ts)를 참고하세요.

```tsx
import { useActivityZIndexBase } from "@grape_design_react/stackflow";
import { Portal } from "@grape_design_react/react";
import { useStepOverlay } from "./use-step-overlay";
// ... more imports

const MyActivity: ActivityComponentType = () => {
  // [!code highlight]
  const { overlayProps, setOpen } = useStepOverlay();
  const { popStep } = useStepFlow("MyActivity");
  const { push } = useFlow();

  return (
    <AppScreen>
      {/* [!code highlight] */}
      <BottomSheetRoot {...overlayProps}>
        <BottomSheetTrigger asChild>
          <ActionButton>Open</ActionButton>
        </BottomSheetTrigger>
        {/* [!code highlight] */}
        <Portal>
          <BottomSheetContent
            title="Step으로 관리되는 Bottom Sheet"
            // [!code highlight]
            layerIndex={useActivityZIndexBase({ activityOffset: 1 })}
          >
            <BottomSheetFooter>
              <HStack gap="x2">
                <ActionButton onClick={() => setOpen(false)}>취소</ActionButton>
                <ActionButton
                  onClick={() => {
                    // [!code highlight]
                    setOpen(false); // 다른 Activity로 이동하기 전에는 Bottom Sheet를 닫으세요.
                    push("ActivityNext");
                  }}
                >
                  다음
                </ActionButton>
              </HStack>
            </BottomSheetFooter>
          </BottomSheetContent>
          {/* [!code highlight] */}
        </Portal>
      </BottomSheetRoot>
    </AppScreen>
  );
};
```

## About `useActivityZIndexBase`

`useActivityZIndexBase`는 각 Activity의 z-index 기준점을 반환하는 훅입니다.

<Accordions>
<Accordion title="useActivityZIndexBase는 어떤 값을 반환하나요?">

- `useActivity().zIndex * 5`를 반환합니다. `useActivity().zIndex`는 현재 Activity가 enter된 Activity 중 몇 번째 Activity인지를 나타내는 값입니다.
- AppScreen을 구성하는 요소들(layer, appbar, dim, edge)은 `useActivityZIndexBase()` 값을 바탕으로 계산된 z-index를 갖습니다.
  ```
  ┌─ 2번 BottomSheet Activity
  │  └─ BottomSheet: 12 (2 × 5 + 2)
  ├─ 1번 AppScreen Activity
  │  ├─ appbar: 12 (1 × 5 + 7)
  │  ├─ edge: 9 (1 × 5 + 4)
  │  ├─ layer: 7 (1 × 5 + 2)
  │  └─ dim: 5 (1 × 5 + 0)
  └─ 0번 AppScreen Activity
     ├─ appbar: 7 (0 × 5 + 7)
     ├─ edge: 4 (0 × 5 + 4)
     ├─ layer: 2 (0 × 5 + 2)
     └─ dim: 0 (0 × 5 + 0)
  ```

</Accordion>
<Accordion title="activityOffset 옵션은 무엇인가요?">

- `activityOffset` 옵션은 현재 Activity가 아닌 다음 Activity의 z-index 기준점을 사용하고 싶을 때 사용합니다.
- 예를 들어, `useActivityZIndexBase({ activityOffset: 1 })`는 다음 Activity의 z-index 기준점을 반환합니다.
- 이는 Step 패턴에서 현재 Activity 위에 BottomSheet를 표시할 때 유용합니다.
  ```
  ┌─ 1번 AppScreen Activity에서 activityOffset: 1로 띄운 BottomSheet (예: Step 패턴)
  │  └─ BottomSheet: 12 ((1 + 1) × 5 + 2)
  ├─ 1번 AppScreen Activity
  │  ├─ appbar: 12 (1 × 5 + 7)
  │  ├─ edge: 9 (1 × 5 + 4)
  │  ├─ layer: 7 (1 × 5 + 2)
  │  └─ dim: 5 (1 × 5 + 0)
  └─ 0번 AppScreen Activity
     ├─ appbar: 7 (0 × 5 + 7)
     ├─ edge: 4 (0 × 5 + 4)
     ├─ layer: 2 (0 × 5 + 2)
     └─ dim: 0 (0 × 5 + 0)
  ```

</Accordion>
<Accordion title="@stackflow/react-ui-core useZIndexBase와 @grape_design_react/stackflow useActivityZIndexBase는 어떻게 다른가요?">

- 두 훅 모두 현재 Activity가 enter된 Activity 중 **몇 번째 Activity인지를 바탕으로 z-index 스타일링에 필요한 값을 반환하는 훅입니다.**
- 두 훅이 반환하는 값은 같으나, [@stackflow/plugin-basic-ui](https://www.npmjs.com/package/@stackflow/plugin-basic-ui)가 아닌, SEED 컴포넌트를 사용하는 경우 SEED가 관리하는 `@grape_design_react/stackflow` 패키지의 `useActivityZIndexBase` 훅을 사용하는 것을 권장합니다.
- `@stackflow/react-ui-core` 패키지의 `useActivityZIndexBase`는 `activityOffset` 옵션을 제공하지 않습니다.
- `@grape_design_react/stackflow@1.1.1`부터 `useActivityZIndexBase` 훅이 제공됩니다.

</Accordion>
<Accordion title="기존에 layerIndex에 수동으로 z-index 값을 지정해주던 코드는 어떻게 변경해야 하나요?">

`layerIndex`를 `useActivity().zIndex * 5 + n` 형태로 지정하고 있었다면 `useActivityZIndexBase() + n`으로 변경할 수 있습니다. 변경 과정에서 `+ n`이 필요한지 함께 검토해보세요.

</Accordion>
</Accordions>
